{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///E:/police-report/app/api/upload-url/route.ts"],"sourcesContent":["import { S3Client, PutObjectCommand } from \"@aws-sdk/client-s3\";\r\nimport { getSignedUrl } from \"@aws-sdk/s3-request-presigner\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\nconst r2 = new S3Client({\r\n  region: \"auto\",\r\n  endpoint: `https://${process.env.R2_ACCOUNT_ID}.r2.cloudflarestorage.com`,\r\n  credentials: {\r\n    accessKeyId: process.env.R2_ACCESS_KEY_ID!,\r\n    secretAccessKey: process.env.R2_SECRET_ACCESS_KEY!,\r\n  },\r\n});\r\n\r\nexport async function POST(request: Request) {\r\n  try {\r\n    const { filename, fileType } = await request.json();\r\n\r\n    // Create a unique name for the file so they don't overwrite each other\r\n    // e.g., \"1738291-evidence.jpg\"\r\n    const uniqueFilename = `${Date.now()}-${filename.replace(/\\s/g, '-')}`;\r\n\r\n    const signedUrl = await getSignedUrl(\r\n      r2,\r\n      new PutObjectCommand({\r\n        Bucket: process.env.R2_BUCKET_NAME,\r\n        Key: uniqueFilename,\r\n        ContentType: fileType,\r\n      }),\r\n      { expiresIn: 60 } // Link works for 60 seconds only\r\n    );\r\n\r\n    return NextResponse.json({ url: signedUrl, key: uniqueFilename });\r\n  } catch (error) {\r\n    console.error(error);\r\n    return NextResponse.json({ error: \"Failed to create upload link\" }, { status: 500 });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,KAAK,IAAI,gOAAQ,CAAC;IACtB,QAAQ;IACR,UAAU,CAAC,QAAQ,EAAE,QAAQ,GAAG,CAAC,aAAa,CAAC,yBAAyB,CAAC;IACzE,aAAa;QACX,aAAa,QAAQ,GAAG,CAAC,gBAAgB;QACzC,iBAAiB,QAAQ,GAAG,CAAC,oBAAoB;IACnD;AACF;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEjD,uEAAuE;QACvE,+BAA+B;QAC/B,MAAM,iBAAiB,GAAG,KAAK,GAAG,GAAG,CAAC,EAAE,SAAS,OAAO,CAAC,OAAO,MAAM;QAEtE,MAAM,YAAY,MAAM,IAAA,0MAAY,EAClC,IACA,IAAI,wOAAgB,CAAC;YACnB,QAAQ,QAAQ,GAAG,CAAC,cAAc;YAClC,KAAK;YACL,aAAa;QACf,IACA;YAAE,WAAW;QAAG,EAAE,iCAAiC;;QAGrD,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,KAAK;YAAW,KAAK;QAAe;IACjE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA+B,GAAG;YAAE,QAAQ;QAAI;IACpF;AACF"}}]
}